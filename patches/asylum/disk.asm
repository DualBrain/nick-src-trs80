;DISK: MODIFIES ASYLUM FOR SAVING
;GAMES TO DISK.
; Assembled OK 30-Mar-85.
	ORG	9267H
	NOP
	NOP
	NOP
	INC	HL
	JP	READ
	ORG	0B01CH
	NOP
	NOP
	NOP
	INC	HL
	JP	WRITE
	ORG	0D000H
;READ: READ FROM DISK
READ	PUSH	DE
	PUSH	HL
	PUSH	BC
	LD	A,'*'
	LD	(3C00H),A
REV01	LD	A,(38FFH)
	OR	A
	JR	NZ,REV01
	CALL	MESS
	LD	A,1
	LD	(37E1H),A
	LD	A,0
	LD	(37ECH),A
	LD	B,10
	DJNZ	$
L1	LD	A,(37ECH)
	BIT	0,A
	JR	NZ,L1
	LD	A,1
	LD	(37E1H),A
	LD	D,38	;TRK
	PUSH	DE
N1	CALL	03E3H
	OR	A
	JR	Z,N1
	CP	41H
	JR	C,N1
	SUB	41H
	POP	DE
	LD	E,A	;SCT
	LD	A,1
	LD	(37E1H),A
	LD	(37EEH),DE
	LD	A,1BH	;SEEK
	LD	(37ECH),A
	LD	B,10
	DJNZ	$
L2	LD	A,(37ECH)
	BIT	0,A
	JR	NZ,L2
	LD	A,88H
	LD	(37ECH),A
	LD	B,10
	DJNZ	$
	POP	BC
	POP	HL
	DEC	HL
L3	LD	A,(37ECH)
	BIT	1,A
	JR	Z,L3
	LD	A,(37EFH)
	INC	HL
	LD	(HL),A
	DJNZ	L3
	POP	DE
	JP	5564H
WRITE	PUSH	DE
	PUSH	HL
	PUSH	BC
	LD	A,':'
	LD	(3C00H),A
WRIV01	LD	A,(38FFH)
	OR	A
	JR	NZ,WRIV01
	CALL	MESS
	LD	A,1
	LD	(37E1H),A
	LD	A,0
	LD	(37ECH),A
	LD	B,10
	DJNZ	$
M1	LD	A,(37ECH)
	BIT	0,A
	JR	NZ,M1
	LD	A,1
	LD	(37E1H),A
	LD	D,38	;TRK
	PUSH	DE
N2	CALL	03E3H
	OR	A
	JR	Z,N2
	CP	41H
	JR	C,N2
	SUB	41H
	POP	DE
	LD	E,A	;SCT
	LD	A,1
	LD	(37E1H),A
	LD	(37EEH),DE
	LD	A,1BH
	LD	(37ECH),A
	LD	B,10
	DJNZ	$
M2	LD	A,(37ECH)
	BIT	0,A
	JR	NZ,M2
	LD	A,0ACH
	LD	(37ECH),A
	LD	B,10
	DJNZ	$
	POP	BC
	POP	HL
	DEC	HL
	PUSH	BC
M3	LD	A,(37ECH)
	BIT	1,A
	JR	Z,M3
	INC	HL
	LD	A,(HL)
	LD	(37EFH),A
	DJNZ	M3
	POP	BC
	XOR	A
	SUB	B
	LD	B,A
M4	LD	A,(37ECH)
	BIT	1,A
	JR	Z,M4
	XOR	A
	LD	(37EFH),A
	DJNZ	M4
	POP	DE
	JP	7319H
MESS	PUSH	DE
	PUSH	IX
	LD	HL,MESSAG
MESV01	LD	A,(HL)
	LD	C,A
	PUSH	HL
	CALL	0458H
	POP	HL
	LD	A,(HL)
	INC	HL
	CP	0DH
	JR	NZ,MESV01
	POP	IX
	POP	DE
	RET
MESSAG	DEFB	1CH
	DEFB	1FH
MES2AG	DEFM	'INSERT DISK0130 AND HIT A-J FOR SAVE #'
	DEFB	0DH
	END	0CE12H
